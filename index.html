<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FKPL3L7HHK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FKPL3L7HHK');
</script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MedStudyeasy ‚Äì MBBS Medical Notes, PYQs & Dr. Strange Medical Guide</title>
<meta name="description" content="Free MBBS medical notes, previous year question papers (PYQs), and Dr. Strange - your personal medical guide. Get instant answers to medical questions and diagnosis help." />
<meta name="keywords" content="MBBS notes, medical notes, PYQ, previous year questions, Dr. Strange medical guide, diagnosis help, medical questions, anatomy notes, physiology notes, pathology notes" />
<meta name="author" content="MedStudyeasy" />

<!-- Open Graph for Social Sharing -->
<meta property="og:title" content="MedStudyeasy ‚Äì Free MBBS Notes, PYQs & Dr. Strange Medical Guide" />
<meta property="og:description" content="Access free MBBS medical notes, previous year question papers, and Dr. Strange - your personal medical guide for instant answers to medical questions." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://www.medstudyeasy.shop/" />
<meta property="og:image" content="https://www.medstudyeasy.shop/logo.png" />

<!-- Mobile Friendly -->
<meta name="theme-color" content="#8B0000" />

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

<style>.locked { pointer-events: none; opacity: 0.6; }
.unlocked { pointer-events: auto; opacity: 1; }
.unlock-btn[disabled] { opacity: 0.6; cursor: default; }
  :root{
    --primary:#2a5c8f;--secondary:#4caf50;--accent:#ff6b6b;
    --bg:#f6f8fb;--card:#fff;--text:#222;--muted:#777;
    --shadow:0 8px 24px rgba(0,0,0,.08);
    --dr-strange-primary: #8B0000;
    --dr-strange-secondary: #FFD700;
    --dr-strange-accent: #4B0082;
  }
  *{box-sizing:border-box}
  html,body{margin:0; padding:0; scroll-behavior: smooth;}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.6}
  
  /* Login Modal Styles */
  #loginModal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--dr-strange-primary), var(--dr-strange-accent));
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    padding: 20px;
  }
  
  .login-container {
    background: white;
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    width: 100%;
    max-width: 400px;
    text-align: center;
  }
  
  .login-logo {
    font-size: 2.5rem;
    margin-bottom: 20px;
    color: var(--dr-strange-primary);
  }
  
  .login-container h2 {
    color: var(--dr-strange-primary);
    margin-bottom: 10px;
    font-size: 1.8rem;
  }
  
  .login-container p {
    color: var(--muted);
    margin-bottom: 30px;
    font-size: 1rem;
  }
  
  .form-group {
    margin-bottom: 20px;
    text-align: left;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 8px;
    color: var(--text);
    font-weight: 600;
  }
  
  .form-group input, .form-group select {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e1e5eb;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.3s;
    font-family: inherit;
  }
  
  .form-group input:focus, .form-group select:focus {
    border-color: var(--dr-strange-primary);
    outline: none;
  }
  
  .login-btn {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, var(--dr-strange-primary), var(--dr-strange-accent));
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s;
    margin-bottom: 15px;
  }
  
  .login-btn:hover {
    transform: translateY(-2px);
  }
  
  .login-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
  }
  
  .login-links {
    margin-top: 20px;
    font-size: 14px;
  }
  
  .login-links a {
    color: var(--dr-strange-primary);
    text-decoration: none;
    font-weight: 600;
    cursor: pointer;
  }
  
  .error-message {
    color: #e74c3c;
    background: #ffeaea;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 15px;
    display: none;
    font-size: 14px;
    text-align: left;
  }
  
  .success-message {
    color: #27ae60;
    background: #eaffea;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 15px;
    display: none;
    font-size: 14px;
  }
  
  /* Main website content - hidden by default */
  #mainContent {
    display: none;
  }
  
  /* Header with hide on scroll functionality */
  header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background: linear-gradient(120deg, var(--dr-strange-primary), var(--dr-strange-accent));
    color: #fff;
    box-shadow: var(--shadow);
    padding: 12px 0;
    transition: transform 0.3s ease;
    transform: translateY(0);
  }
  
  header.hidden {
    transform: translateY(-100%);
  }
  
  .wrap{max-width:1100px;margin:auto;padding:0 16px}
  .nav{display:flex;align-items:center;justify-content:space-between;padding:0}
  .brand{display:flex;gap:8px;align-items:center}
  .brand i{font-size:24px}
  .brand b{font-size:18px;letter-spacing:.3px}
  
  /* Auth buttons in header */
  .auth-buttons {
    display: flex;
    gap: 10px;
    align-items: center;
  }
  
  .user-welcome {
    font-size: 14px;
    color: white;
    margin-right: 10px;
  }
  
  .logout-btn {
    background: transparent;
    color: white;
    border: 2px solid #ff6b6b;
    padding: 6px 12px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
  }
  
  .logout-btn:hover {
    background: #ff6b6b;
    transform: translateY(-2px);
  }
  
  /* Compact Hero */
  .hero {
    padding: 80px 0 20px;
    background: linear-gradient(120deg, var(--dr-strange-primary), var(--dr-strange-accent));
    color: #fff;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
  }
  
  .hero::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
      radial-gradient(circle at 20% 30%, rgba(255, 215, 0, 0.2) 0%, transparent 50%),
      radial-gradient(circle at 80% 70%, rgba(139, 0, 0, 0.2) 0%, transparent 50%);
    z-index: 1;
  }
  
  .hero .wrap {
    position: relative;
    z-index: 2;
  }
  
  .hero h1{margin:.2rem 0 .4rem;font-size:24px}
  .hero p{margin:0;color:#e6eefb; font-size:14px;}
  
  /* Dr. Strange Button */
  .dr-strange-btn {
    padding:12px 20px;
    font-size:16px;
    margin-top:12px;
    background: linear-gradient(135deg, var(--dr-strange-primary), var(--dr-strange-accent));
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
    display:inline-block;
    text-align:center;
    transition: transform 0.2s, box-shadow 0.2s;
    text-decoration: none;
    box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
    position: relative;
    overflow: hidden;
  }
  
  .dr-strange-btn::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: 0.5s;
  }
  
  .dr-strange-btn:hover::before {
    left: 100%;
  }
  
  .dr-strange-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(139, 0, 0, 0.4);
  }
  
  /* Dr. Strange Logo */
  .dr-strange-logo {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 20px 0;
  }
  
  .logo-container {
    position: relative;
    width: 120px;
    height: 120px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .logo-outer-ring {
    position: absolute;
    width: 120px;
    height: 120px;
    border: 3px solid var(--dr-strange-secondary);
    border-radius: 50%;
    animation: rotate 20s linear infinite;
  }
  
  .logo-inner-ring {
    position: absolute;
    width: 100px;
    height: 100px;
    border: 2px solid var(--dr-strange-primary);
    border-radius: 50%;
    animation: rotate 15s linear infinite reverse;
  }
  
  .logo-symbol {
    position: relative;
    width: 70px;
    height: 70px;
    background: var(--dr-strange-primary);
    clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--dr-strange-secondary);
    font-size: 24px;
    font-weight: bold;
  }
  
  @keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  /* Content sections */
  .content-section {
    background: #fff;
    padding: 20px;
    margin: 20px 0;
    border-radius: 8px;
    box-shadow: var(--shadow);
  }
  .content-section h2 {
    color: var(--primary);
    border-bottom: 2px solid var(--primary);
    padding-bottom: 8px;
    margin-top: 0;
    font-size: 20px;
  }
  
  /* Subject descriptions */
  .subject-info {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
    margin-top: 16px;
  }
  .subject-card {
    background: #f8fafd;
    border-radius: 8px;
    padding: 14px;
    border-left: 4px solid var(--primary);
    font-size: 14px;
  }
  .subject-card h3 {
    margin-top: 0;
    color: var(--primary);
    font-size: 16px;
  }
  
  /* tabs */
  .tabs{margin:16px auto 0;background:var(--card);border-radius:12px;padding:12px;box-shadow:var(--shadow)}
  .tab-bar{display:flex;gap:8px;flex-wrap:wrap}
  .tab-btn{flex:1 1 140px;background:#eef4fb;border-radius:8px;padding:8px 12px;border:0;font-weight:700;color:#16406e;cursor:pointer; font-size: 14px;}
  .tab-btn.active{background:var(--primary);color:#fff}
  .top-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
  .search{flex:1 1 240px;display:flex;border:1px solid #dde6f2;background:#f2f6fb;border-radius:8px;overflow:hidden}
  .search input{flex:1;padding:8px 10px;border:0;background:transparent; font-size: 14px;}
  .search button{border:0;background:var(--secondary);color:#fff;padding:0 12px;cursor:pointer}
  .year-row{display:flex;gap:6px;flex-wrap:wrap}
  .pill{border:1px solid #d9e4f2;background:#fff;padding:6px 10px;border-radius:999px;cursor:pointer; font-size: 13px;}
  .pill.active{background:var(--primary);color:#fff;border-color:var(--primary)}
  /* grid */
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:12px}
  .card{background:var(--card);border-radius:10px;box-shadow:var(--shadow);padding:12px;display:flex;flex-direction:column;gap:8px}
  .card h3{margin:0;font-size:15px}
  .sub-list{display:flex;flex-direction:column;gap:6px}
  .sub{display:flex;align-items:center;gap:8px;justify-content:space-between;border:1px dashed #e6ecf4;border-radius:8px;padding:8px}
  .sub .left{display:flex;align-items:center;gap:8px}
  .tag{font-size:11px;background:#eef4fb;color:#16406e;border-radius:999px;padding:3px 6px}
  .acts{display:flex;gap:5px}
  .icon-btn{border:0;padding:6px 8px;border-radius:6px;cursor:pointer;background:#f2f6fb; font-size: 12px;}
  .icon-btn.view{background:#eaf2ff;color:#184a85}
  .muted{color:var(--muted);font-size:11px}
  /* modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:14px;z-index:200}
  .modal.show{display:flex}
  .dialog{background:#fff;max-width:600px;width:100%;border-radius:10px;padding:16px;box-shadow:var(--shadow);max-height:80vh;overflow:auto}
  .dialog h3{margin:0 0 8px; font-size: 18px;}
  .dialog .close{float:right;cursor:pointer;color:#999;font-size:24px;padding:5px;}
  .pyq-paper{margin:8px 0;padding:6px;border-radius:6px;background:#f6fbff;border:1px solid #e7f0fb}
  .pyq-year{display:flex;align-items:center;gap:6px;flex-wrap:wrap;margin:4px 0}
  .btn-link{display:inline-block;padding:5px 8px;border-radius:6px;color:#fff;text-decoration:none;font-weight:700;font-size:12px;margin-right:5px}
  .btn-summer{background:var(--secondary)}
  .btn-winter{background:var(--primary)}
  .btn-disabled{display:inline-block;padding:5px 8px;border-radius:6px;background:#efefef;color:#999;font-weight:700;font-size:12px;margin-right:5px}
  /* footer */
  footer{color:#fff;background:#0f1c2c;margin-top:20px; padding: 16px 0;}
  footer .wrap{padding:14px}
  
  /* Additional content styles */
  .resource-list {
    list-style: none;
    padding: 0;
    font-size: 14px;
  }
  .resource-list li {
    margin-bottom: 8px;
    padding-left: 20px;
    position: relative;
  }
  .resource-list li:before {
    content: "‚Ä¢";
    color: var(--accent);
    font-weight: bold;
    position: absolute;
    left: 8px;
  }
  
  /* Quick navigation */
  .quick-nav {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 16px 0;
  }
  .nav-pill {
    background: #eef4fb;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    color: var(--primary);
    text-decoration: none;
    transition: all 0.2s;
  }
  .nav-pill:hover {
    background: var(--primary);
    color: white;
  }
  
  /* Back to top button */
  .back-to-top {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--primary);
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: var(--shadow);
    z-index: 999;
    opacity: 0;
    transition: opacity 0.3s;
  }
  
  .back-to-top.visible {
    opacity: 1;
  }
  
  /* Dr. Strange Section Styling */
  .dr-strange-section {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-left: 5px solid var(--dr-strange-primary);
    position: relative;
    overflow: hidden;
  }
  
  .dr-strange-section::before {
    content: "";
    position: absolute;
    top: -50%;
    right: -10%;
    width: 200px;
    height: 200px;
    background: radial-gradient(circle, rgba(139, 0, 0, 0.1) 0%, transparent 70%);
    border-radius: 50%;
  }
  
  .diagnosis-help {
    background: #fff;
    border-radius: 10px;
    padding: 15px;
    margin: 15px 0;
    border: 1px solid #e0e0e0;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
  }
  
  .diagnosis-help h3 {
    color: var(--dr-strange-primary);
    margin-top: 0;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .diagnosis-help h3 i {
    color: var(--dr-strange-accent);
  }
  
  /* small screens: modal comfortable */
  @media (max-width:480px){
    .dialog{padding:12px}
    .btn-link{padding:4px 6px;font-size:11px}
    .dr-strange-btn {
      width:100%;
      font-size:16px;
      padding:14px 0;
      margin-top:16px;
    }
    .subject-info {
      grid-template-columns: 1fr;
    }
    .hero h1 {
      font-size: 20px;
    }
    .tab-btn {
      flex: 1 1 120px;
      font-size: 13px;
    }
    .hero {
      padding: 70px 0 15px;
    }
    .logo-container {
      width: 100px;
      height: 100px;
    }
    .logo-outer-ring {
      width: 100px;
      height: 100px;
    }
    .logo-inner-ring {
      width: 80px;
      height: 80px;
    }
    .logo-symbol {
      width: 60px;
      height: 60px;
      font-size: 20px;
    }
    .auth-buttons {
      gap: 5px;
    }
    .logout-btn {
      padding: 6px 10px;
      font-size: 12px;
    }
    .user-welcome {
      display: none;
    }
    .login-container {
      padding: 30px 20px;
    }
    #signupModal .dialog {
      max-width: 90%;
      margin: 20px;
    }
  }
</style>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1751053028345383"
     crossorigin="anonymous"></script>
</head>
<body>
  <!-- Login Modal - Shows First -->
  <div id="loginModal">
    <div class="login-container">
      <div class="login-logo">üìö</div>
      <h2>Welcome to MedStudyeasy</h2>
      <p>Please login to access medical study resources</p>
      
      <div id="loginErrorMessage" class="error-message"></div>
      <div id="loginSuccessMessage" class="success-message"></div>
      
      <form id="loginForm">
        <div class="form-group">
          <label for="loginEmail">Email Address</label>
          <input type="email" id="loginEmail" placeholder="Enter your email" required>
        </div>
        
        <div class="form-group">
          <label for="loginPassword">Password</label>
          <input type="password" id="loginPassword" placeholder="Enter your password" required>
        </div>
        
        <button type="submit" class="login-btn" id="loginSubmitBtn">
          Login to MedStudyeasy
        </button>
      </form>
      
      <div class="login-links">
        <p>Don't have an account? <a href="#" id="showSignup">Create account</a></p>
      </div>
    </div>
  </div>

  <!-- Signup Modal -->
  <div id="signupModal" class="modal">
    <div class="dialog" style="max-width: 500px;">
      <span class="close" id="closeSignup">&times;</span>
      <h3>Create Medical Student Account</h3>
      
      <div id="signupErrorMessage" class="error-message"></div>
      <div id="signupSuccessMessage" class="success-message"></div>
      
      <form id="signupForm">
        <div class="form-group">
          <label for="signupEmail">Email Address *</label>
          <input type="email" id="signupEmail" placeholder="Enter your college email" required>
        </div>
        
        <div class="form-group">
          <label for="signupPassword">Password * (min. 6 characters)</label>
          <input type="password" id="signupPassword" placeholder="Create a password" required minlength="6">
        </div>

        <div class="form-group">
          <label for="fullName">Full Name *</label>
          <input type="text" id="fullName" placeholder="Enter your full name" required>
        </div>

        <div class="form-group">
          <label for="medicalCollege">Medical College *</label>
          <input type="text" id="medicalCollege" placeholder="e.g., AIIMS Delhi, KGMU Lucknow" required>
        </div>

        <div style="display: flex; gap: 15px;">
          <div class="form-group" style="flex: 1;">
            <label for="batch">Batch *</label>
            <select id="batch" required>
              <option value="">Select Batch</option>
              <option value="2020">2020</option>
              <option value="2021">2021</option>
              <option value="2022">2022</option>
              <option value="2023">2023</option>
              <option value="2024">2024</option>
              <option value="2025">2025</option>
            </select>
          </div>
          
          <div class="form-group" style="flex: 1;">
            <label for="currentYear">Current Year *</label>
            <select id="currentYear" required>
              <option value="">Select Year</option>
              <option value="1st">1st Year</option>
              <option value="2nd">2nd Year</option>
              <option value="3rd">3rd Year</option>
              <option value="4th">4th Year</option>
              <option value="Internship">Internship</option>
            </select>
          </div>
        </div>

        <button type="submit" class="login-btn" id="signupSubmitBtn" style="margin-top: 20px;">
          Create Medical Student Account
        </button>
      </form>
      
      <div class="login-links">
        <p>Already have an account? <a href="#" id="showLogin">Login here</a></p>
      </div>
    </div>
  </div>

  <!-- Main Website Content - Hidden until login -->
  <div id="mainContent">
    <!-- Header with hide on scroll -->
    <header id="main-header">
      <div class="wrap nav">
        <div class="brand"><i class="fa-solid fa-book-medical"></i><b>MedStudyeasy</b></div>
        <div class="auth-buttons" id="authButtons">
          <span class="user-welcome" id="userWelcome">Welcome!</span>
          <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
      </div>
    </header>

    <!-- Hero section -->
    <section class="hero">
      <div class="wrap">
        <h1>MBBS Medical Notes & Previous Year Questions</h1>
        <p>Comprehensive study resources for medical students</p>
        
        <!-- Dr. Strange Logo -->
        <div class="dr-strange-logo">
          <div class="logo-container">
            <div class="logo-outer-ring"></div>
            <div class="logo-inner-ring"></div>
            <div class="logo-symbol">DS</div>
          </div>
        </div>
        
        <a href="ai.html" class="dr-strange-btn">
          üîÆ Consult Dr. Strange
        </a>
      </div>
    </section>

    <div class="wrap">
      <!-- Quick Navigation -->
      <div class="quick-nav">
        <a href="#about" class="nav-pill">About</a>
        <a href="#subjects" class="nav-pill">Subjects</a>
        <a href="#resources" class="nav-pill">Resources</a>
        <a href="#dr-strange" class="nav-pill">Dr. Strange</a>
        <a href="#contact" class="nav-pill">Contact</a>
        <a href="#support" class="nav-pill">Support Us</a>
      </div>

      <!-- Introduction Section -->
      <section class="content-section" id="about">
        <h2>About MedStudyeasy</h2>
        <p>MedStudyeasy provides free access to high-quality handwritten medical notes, previous year question papers (PYQs), and Dr. Strange - your personal medical guide to help medical students excel in their studies.</p>
        
        <h3>What We Offer:</h3>
        <ul class="resource-list">
          <li><strong>Handwritten Notes</strong> - Concise, well-organized notes for quick revision</li>
          <li><strong>Previous Year Questions</strong> - Exam papers to understand question patterns</li>
          <li><strong>Practical Notes</strong> - Step-by-step guides for practical exams</li>
          <li><strong>MBBS Books</strong> - Essential textbooks and reference materials</li>
          <li><strong>Dr. Strange</strong> - Your personal medical guide for diagnosis help and instant answers to medical questions</li>
          <li><strong>All MBBS Subjects</strong> - Comprehensive coverage from 1st to 4th year</li>
          <li><strong>Completely Free</strong> - All resources available at no cost</li>
        </ul>
      </section>

      <!-- Subject Information Section -->
      <section class="content-section" id="subjects">
        <h2>MBBS Subjects Covered</h2>
        <p>We provide comprehensive study materials for all subjects in the MBBS curriculum with concise handwritten notes and previous year questions.</p>
        
        <div class="subject-info">
          <div class="subject-card">
            <h3>Anatomy</h3>
            <p>Handwritten notes covering gross anatomy, histology, and embryology. Includes diagrams for visual learning.</p>
          </div>
          <div class="subject-card">
            <h3>Physiology</h3>
            <p>Concise notes on all body systems with emphasis on key concepts and mechanisms.</p>
          </div>
          <div class="subject-card">
            <h3>Biochemistry</h3>
            <p>Simplified notes on metabolic pathways, molecular biology, and clinical biochemistry.</p>
          </div>
          <div class="subject-card">
            <h3>Pathology</h3>
            <p>Well-organized notes covering general and systemic pathology with important disease mechanisms.</p>
          </div>
          <div class="subject-card">
            <h3>Pharmacology</h3>
            <p>Drug classifications, mechanisms, side effects, and therapeutic uses in concise format.</p>
          </div>
          <div class="subject-card">
            <h3>Microbiology</h3>
            <p>Notes on bacteria, viruses, fungi, and parasites with clinical correlations.</p>
          </div>
          <div class="subject-card">
            <h3>Medicine</h3>
            <p>Comprehensive notes on internal medicine with focus on high-yield topics for exams.</p>
          </div>
          <div class="subject-card">
            <h3>Surgery</h3>
            <p>Principles and procedures summarized with surgical techniques and management protocols.</p>
          </div>
          <div class="subject-card">
            <h3>OBG</h3>
            <p>Obstetrics and gynecology notes covering pregnancy, delivery, and women's health issues.</p>
          </div>
          <div class="subject-card">
            <h3>Pediatrics</h3>
            <p>Child health notes with growth milestones, development, and common childhood diseases.</p>
          </div>
          <div class="subject-card">
            <h3>PSM</h3>
            <p>Community medicine notes on epidemiology, biostatistics, and public health programs.</p>
          </div>
          <div class="subject-card">
            <h3>FMT</h3>
            <p>Forensic medicine notes covering toxicology, medical jurisprudence, and autopsy procedures.</p>
          </div>
        </div>
      </section>

      <!-- Resources Section -->
      <section class="tabs" id="resources">
        <h2>Study Resources</h2>
        <p>Browse our collection of handwritten medical notes, practical notes, MBBS books, and previous year question papers organized by year and subject.</p>
        
        <div class="tab-bar">
          <button class="tab-btn active" data-tab="notes"><i class="fa-solid fa-note-sticky"></i> Handwritten Notes</button>
          <button class="tab-btn" data-tab="practical"><i class="fa-solid fa-flask"></i> Practical Notes</button>
          <button class="tab-btn" data-tab="books"><i class="fa-solid fa-book"></i> MBBS Books</button>
          <button class="tab-btn" data-tab="pyq"><i class="fa-solid fa-file-lines"></i> Previous Year Questions</button>
        </div>

        <div class="top-row">
          <div class="search">
            <input id="searchBox" placeholder="Search subjects‚Ä¶" />
            <button id="clearSearch" title="Clear"><i class="fa-solid fa-xmark"></i></button>
          </div>
          <div class="year-row" id="yearRow">
            <span class="pill active" data-year="1">1st Year</span>
            <span class="pill" data-year="2">2nd Year</span>
            <span class="pill" data-year="3">3rd Year</span>
            <span class="pill" data-year="4">4th Year</span>
          </div>
        </div>

        <div class="grid" id="cardsGrid"></div>
        <div style="margin-top:8px">
          <div class="muted">Showing <span id="count">0</span> subjects</div>
        </div>
      </section>

      <!-- Dr. Strange Section -->
      <section class="content-section dr-strange-section" id="dr-strange">
        <h2>Dr. Strange - Your Personal Medical Guide</h2>
        <p>Having trouble with diagnosis or any medical question? Dr. Strange is your mystical medical guide available 24/7 to provide instant answers and guidance through the complexities of medicine.</p>
        
        <div class="diagnosis-help">
          <h3><i class="fa-solid fa-stethoscope"></i> Diagnosis Assistance</h3>
          <p>Struggling with differential diagnosis? Dr. Strange can help you narrow down possibilities based on symptoms, lab results, and clinical findings.</p>
        </div>
        
        <div class="diagnosis-help">
          <h3><i class="fa-solid fa-question-circle"></i> Medical Questions</h3>
          <p>Get instant answers to any medical question - from basic concepts to complex clinical scenarios. Perfect for exam preparation and clinical rotations.</p>
        </div>
        
        <div class="diagnosis-help">
          <h3><i class="fa-solid fa-pills"></i> Treatment Guidance</h3>
          <p>Need help with treatment protocols, drug interactions, or management plans? Dr. Strange provides evidence-based recommendations.</p>
        </div>
        
        <h3>Features:</h3>
        <ul class="resource-list">
          <li>Instant answers to medical questions and diagnosis help</li>
          <li>Explanation of complex concepts with clinical examples</li>
          <li>Differential diagnosis assistance based on symptoms</li>
          <li>Customized practice quizzes based on your weak areas</li>
          <li>Revision assistance before exams</li>
          <li>Available anytime, anywhere - your 24/7 medical guide</li>
        </ul>
        
        <a href="ai.html" class="dr-strange-btn" style="display: inline-block; margin-top: 15px;">
          üîÆ Consult Dr. Strange Now
        </a>
      </section>
    </div>

    <!-- Resource Modal -->
    <div class="modal" id="modal" aria-hidden="true">
      <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <span class="close" id="modalClose" title="Close">&times;</span>
        <h3 id="modalTitle">Title</h3>
        <div id="modalBody"></div>
      </div>
    </div>

    <!-- Back to top button -->
    <div class="back-to-top" id="backToTop">
      <i class="fas fa-arrow-up"></i>
    </div>

    <footer>
      <a href="ai.html">
        <button style="padding:10px 20px; font-size:16px; margin:10px; background:var(--dr-strange-primary); color:white; border:none; border-radius:5px; cursor:pointer;">
          üîÆ Consult Dr. Strange
        </button>
      </a>

      <!-- Visitor Counter Start -->
      <div id="visitor-counter" style="text-align: center; margin: 20px 0;">
        <span style="font-size: 16px; font-weight: bold;">Visitor Count:</span>
        <span id="visit-count" style="font-size: 16px; color: #333;">0</span>
      </div>
      
      <section id="contact" style="padding:60px 20px; background:#f8f9fa; text-align:center;">
        <h2 style="font-size:2rem; margin-bottom:20px; color:#222;">Contact Us</h2>
        <p style="margin-bottom:30px; font-size:1.1rem; color:#555;">
          Have questions, suggestions, or feedback? We'd love to hear from you!
        </p>
        
        <form action="https://formspree.io/f/xnngdkdq" method="POST" 
              style="max-width:500px;margin:auto; background:#fff; padding:25px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.08);">
          
          <input type="text" name="name" placeholder="Your Name" required 
                 style="width:100%;padding:12px;margin:10px 0;border:1px solid #ddd;border-radius:5px;font-size:1rem;">
          
          <input type="email" name="email" placeholder="Your Email" required 
                 style="width:100%;padding:12px;margin:10px 0;border:1px solid #ddd;border-radius:5px;font-size:1rem;">
          
          <textarea name="message" placeholder="Your Message" required 
                    style="width:100%;padding:12px;margin:10px 0;border:1px solid #ddd;border-radius:5px;font-size:1rem;min-height:120px;"></textarea>
          
          <button type="submit" 
                  style="width:100%;padding:12px;background:#007BFF;color:#fff;font-size:1.1rem;border:none;border-radius:5px;cursor:pointer;transition:0.3s;">
            Send Message
          </button>
        </form>
      </section>
      
      <div class="wrap">
        <small>&copy; <span id="yr"></span> MedStudy. Built for medicos ‚ù§Ô∏è</small>
      </div>
    </footer>

    <section style="background: var(--card); border-radius: 14px; padding: 20px; margin: 20px 16px; box-shadow: var(--shadow); text-align: center;" id="support">
      <h2><i class="fa-solid fa-heart"></i> Support MedStudy</h2>
      <p>Your donation helps us maintain and improve this platform for all medicos.</p>
      <a href="upi://pay?pa=913078294521@ybl&pn=MedStudy&cu=INR" 
         style="display: inline-block; background: var(--secondary); color: white; padding: 12px 20px; border-radius: 8px; text-decoration: none; margin: 10px; font-weight: bold;">
        <i class="fa-solid fa-indian-rupee-sign"></i> Donate via UPI
      </a>
      <p style="font-size: 14px; color: var(--muted); margin-top: 10px;">
        UPI ID: 913078294521@ybl
      </p>
    </section>
  </div>

<!-- JSON-LD Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "MedStudyeasy",
  "url": "https://www.medstudyeasy.shop/",
  "description": "Free MBBS medical notes, previous year question papers, and Dr. Strange - your personal medical guide for diagnosis help and instant answers to medical questions",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://www.medstudyeasy.shop/search?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "EducationalOrganization",
  "name": "MedStudyeasy",
  "url": "https://www.medstudyeasy.shop/",
  "logo": "https://www.medstudyeasy.shop/logo.png",
  "description": "Free MBBS medical notes, PYQs, and Dr. Strange - your personal medical guide for medical students.",
  "sameAs": [
    "https://www.facebook.com/",
    "https://www.instagram.com/"
  ]
}
</script>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>

<script>
// Firebase Configuration
const firebaseConfig = {
  apiKey: "AIzaSyAivdKu90qWik88ykWxgvs4ZR2DTBRFykA",
  authDomain: "medstudyeasy-f1e25.firebaseapp.com",
  projectId: "medstudyeasy-f1e25",
  storageBucket: "medstudyeasy-f1e25.firebasestorage.app",
  messagingSenderId: "479468659075",
  appId: "1:479468659075:web:ac7949ee17a6832a2c56b6",
  measurementId: "G-N96DW95QRK"
};

// Initialize Firebase
try {
  firebase.initializeApp(firebaseConfig);
  console.log("Firebase initialized successfully");
} catch (error) {
  console.error("Firebase initialization error:", error);
}

const auth = firebase.auth();
const db = firebase.firestore();

// DOM Elements
const loginModal = document.getElementById('loginModal');
const signupModal = document.getElementById('signupModal');
const mainContent = document.getElementById('mainContent');
const userWelcome = document.getElementById('userWelcome');

// Show main content and hide login modal
function showMainContent(user) {
  loginModal.style.display = 'none';
  mainContent.style.display = 'block';
  if (user) {
    userWelcome.textContent = `Welcome, ${user.email}`;
  }
}

// Show login modal and hide main content
function showLoginModal() {
  loginModal.style.display = 'flex';
  mainContent.style.display = 'none';
  hideSignupModal();
  // Clear previous messages
  document.getElementById('loginErrorMessage').style.display = 'none';
  document.getElementById('loginSuccessMessage').style.display = 'none';
  document.getElementById('loginForm').reset();
}

// Show signup modal
function showSignupModal() {
  signupModal.classList.add('show');
  // Clear previous messages
  document.getElementById('signupErrorMessage').style.display = 'none';
  document.getElementById('signupSuccessMessage').style.display = 'none';
  document.getElementById('signupForm').reset();
}

// Hide signup modal
function hideSignupModal() {
  signupModal.classList.remove('show');
}

// Updated login functionality
document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  const errorDiv = document.getElementById('loginErrorMessage');
  const successDiv = document.getElementById('loginSuccessMessage');
  const submitBtn = document.getElementById('loginSubmitBtn');

  // Clear previous messages
  errorDiv.style.display = 'none';
  successDiv.style.display = 'none';
  
  // Show loading state
  submitBtn.textContent = 'Logging in...';
  submitBtn.disabled = true;

  try {
    console.log("Attempting login for:", email);
    const userCredential = await auth.signInWithEmailAndPassword(email, password);
    const user = userCredential.user;
    console.log("Login successful:", user.email);
    
    // Ensure user document exists in Firestore
    const userRef = db.collection('users').doc(user.uid);
    const userSnap = await userRef.get();
    
    if (!userSnap.exists) {
      // Create user document with basic structure
      await userRef.set({
        email: email,
        premium_surgery1: false,
        accountType: 'free',
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
        // Add default premium fields for all premium content
        premium_anat: false,
        premium_biochem: false,
        premium_physio: false,
        premium_pharma: false,
        premium_micro: false,
        premium_patho: false,
        premium_psm: false,
        premium_fmt: false,
        premium_peds: false,
        premium_medicine: false,
        premium_surgery1: false,
        premium_surgery2: false,
        premium_obg: false,
        premium_gynae: false,
        premium_ent: false,
        premium_oph: false
      });
      console.log("New user document created");
    } else {
      // Update last login for existing user
      await userRef.update({
        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
      });
    }
    
    showMainContent(user);
  } catch (error) {
    console.error("Login error:", error);
    errorDiv.textContent = getErrorMessage(error.code);
    errorDiv.style.display = 'block';
    
    // Reset button
    submitBtn.textContent = 'Login to MedStudyeasy';
    submitBtn.disabled = false;
  }
});

// Signup functionality
document.getElementById('signupForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const email = document.getElementById('signupEmail').value;
  const password = document.getElementById('signupPassword').value;
  const fullName = document.getElementById('fullName').value;
  const medicalCollege = document.getElementById('medicalCollege').value;
  const batch = document.getElementById('batch').value;
  const currentYear = document.getElementById('currentYear').value;
  
  const errorDiv = document.getElementById('signupErrorMessage');
  const successDiv = document.getElementById('signupSuccessMessage');
  const submitBtn = document.getElementById('signupSubmitBtn');

  // Clear previous messages
  errorDiv.style.display = 'none';
  successDiv.style.display = 'none';
  
  // Validate form
  if (!email || !password || !fullName || !medicalCollege || !batch || !currentYear) {
    errorDiv.textContent = 'Please fill in all required fields.';
    errorDiv.style.display = 'block';
    return;
  }

  if (password.length < 6) {
    errorDiv.textContent = 'Password must be at least 6 characters long.';
    errorDiv.style.display = 'block';
    return;
  }

  // Show loading state
  submitBtn.textContent = 'Creating Account...';
  submitBtn.disabled = true;

  try {
    console.log("Attempting to create account for:", email);
    
    // 1. Create authentication account
    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
    const user = userCredential.user;
    console.log("Auth account created:", user.uid);

    // Updated signup functionality - add this inside the try block after creating user
// 2. Store additional user data in Firestore with all premium fields
await db.collection('users').doc(user.uid).set({
  email: email,
  fullName: fullName,
  medicalCollege: medicalCollege,
  batch: batch,
  currentYear: currentYear,
  accountType: 'free',
  // Initialize all premium fields as false
  premium_anat: false,
  premium_biochem: false,
  premium_physio: false,
  premium_pharma: false,
  premium_micro: false,
  premium_patho: false,
  premium_psm: false,
  premium_fmt: false,
  premium_peds: false,
  premium_medicine: false,
  premium_surgery1: false,
  premium_surgery2: false,
  premium_obg: false,
  premium_gynae: false,
  premium_ent: false,
  premium_oph: false,
  createdAt: firebase.firestore.FieldValue.serverTimestamp(),
  lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
  profileCompleted: true
});
    
    console.log("User data saved to Firestore");

    // 3. Show success message
    successDiv.textContent = 'Account created successfully! You are now logged in.';
    successDiv.style.display = 'block';

    // 4. Show main content after a short delay
    setTimeout(() => {
      showMainContent(user);
      hideSignupModal();
    }, 1500);

  } catch (error) {
    console.error("Signup error:", error);
    let errorMessage = getErrorMessage(error.code);
    
    // More specific error handling
    if (error.code === 'auth/email-already-in-use') {
      errorMessage = 'This email is already registered. Please login instead.';
    } else if (error.code === 'auth/weak-password') {
      errorMessage = 'Password is too weak. Please use at least 6 characters.';
    } else if (error.code === 'auth/invalid-email') {
      errorMessage = 'Invalid email address. Please check your email.';
    }
    
    errorDiv.textContent = errorMessage;
    errorDiv.style.display = 'block';
    
    // Reset button
    submitBtn.textContent = 'Create Medical Student Account';
    submitBtn.disabled = false;
  }
});

// Enhanced error message helper
function getErrorMessage(errorCode) {
  const errorMessages = {
    'auth/invalid-email': 'Invalid email address format.',
    'auth/user-disabled': 'This account has been disabled.',
    'auth/user-not-found': 'No account found with this email.',
    'auth/wrong-password': 'Incorrect password.',
    'auth/too-many-requests': 'Too many failed attempts. Please try again later.',
    'auth/email-already-in-use': 'This email is already registered.',
    'auth/weak-password': 'Password should be at least 6 characters long.',
    'auth/operation-not-allowed': 'Email/password accounts are not enabled.',
    'auth/network-request-failed': 'Network error. Please check your connection.',
    'firestore/permission-denied': 'Database permission denied. Please try again.'
  };
  return errorMessages[errorCode] || 'An unexpected error occurred. Please try again.';
}

// Logout function
function logout() {
  auth.signOut().then(() => {
    console.log("User logged out");
    showLoginModal();
  }).catch((error) => {
    console.error('Logout error:', error);
  });
}

// Event listeners for modal navigation
document.getElementById('showSignup').addEventListener('click', (e) => {
  e.preventDefault();
  showSignupModal();
});

document.getElementById('showLogin').addEventListener('click', (e) => {
  e.preventDefault();
  showLoginModal();
});

document.getElementById('closeSignup').addEventListener('click', hideSignupModal);

// Close signup modal when clicking outside
signupModal.addEventListener('click', (e) => {
  if (e.target === signupModal) {
    hideSignupModal();
  }
});

// Check if user is already logged in on page load
auth.onAuthStateChanged((user) => {
  if (user) {
    console.log("User already logged in:", user.email);
    // User is signed in, show main content
    showMainContent(user);
  } else {
    console.log("No user logged in, showing login modal");
    // No user signed in, show login modal
    showLoginModal();
  }
});

// Test Firebase connection
function testFirebaseConnection() {
  console.log("Testing Firebase connection...");
  console.log("Firebase app:", firebase.apps[0] ? "Connected" : "Not connected");
  console.log("Auth object:", auth ? "Available" : "Not available");
  console.log("Firestore object:", db ? "Available" : "Not available");
}

// Run test on load
window.addEventListener('load', testFirebaseConnection);

/* ======= SCROLL BEHAVIOR ======= */
let lastScrollTop = 0;
const header = document.getElementById('main-header');
const backToTop = document.getElementById('backToTop');
const scrollThreshold = 100;

// Hide header on scroll down, show on scroll up
window.addEventListener('scroll', function() {
  const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
  
  if (scrollTop > lastScrollTop && scrollTop > scrollThreshold) {
    // Scroll down - hide header
    header.classList.add('hidden');
  } else {
    // Scroll up - show header
    header.classList.remove('hidden');
  }
  
  lastScrollTop = scrollTop;
  
  // Show/hide back to top button
  if (scrollTop > 300) {
    backToTop.classList.add('visible');
  } else {
    backToTop.classList.remove('visible');
  }
});

// Back to top functionality
backToTop.addEventListener('click', function() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

/* ======= DATA ======= */
const driveDemoLink = "https://drive.google.com/file/d/1wP4uK_GA6rjg_4maZpmbDNSynhvZnCNo/view?usp=drive_link";
const DATA = {
  notes: {
    1: [
      { id:"anat", display:"Anatomy", link:driveDemoLink },
      { id:"biochem", display:"Biochemistry", link:driveDemoLink },
      { id:"physio", display:"Physiology", link:driveDemoLink }
    ],
    2: [
      { id:"pharma", display:"Pharmacology", link:driveDemoLink },
      { id:"micro", display:"Microbiology", link:"https://drive.google.com/file/d/1wcWU0VPzkqmitVRMsgM3crHKALuKsHB-/view?usp=share_link" },
      { id:"patho", display:"Pathology", link:"https://drive.google.com/file/d/1wd3Gktig0iTydsXb8JqlKawitIsy1_Py/view?usp=share_link" }
    ],
    3: [
      { id:"psm", display:"PSM", link:"https://drive.google.com/file/d/1wP4uK_GA6rjg_4maZpmbDNSynhvZnCNo/view?usp=drive_link" },
      { id:"psm2", display:"PSM2", link:"https://drive.google.com/file/d/1LtwDGeWLF357elmtbA-R_uujHqmM2jC_/view?usp=drive_link" },{ id:"fmt concise reddy", display:"fmt concise reddy", link:"https://drive.google.com/file/d/1wnqsdt0st5wy60zAg7DKZFeAl_vMgu4T/view?usp=share_link" },{ id:"fmt", display:"FMT", link:"https://drive.google.com/file/d/1BhySXMqZxcnLSccq-D0UB9-rGb1YIsN1/view?usp=drive_link" },
    ],
    4: [
      { 
        id:"surgery1", 
        display:"Surgery 1", 
        link:"https://drive.google.com/file/d/1BbNuZcoC0MmDEPL4PBQEl7z79lsR_mhW/view?usp=drivesdk",
        premium: true,
        price: 1
      },
      { id:"peds", display:"Pediatrics", link:"https://drive.google.com/file/d/1sNoc8qLR5VznT28MIrJ0CvCgW6OunF_v/view?usp=drive_link" },
      { id:"medicine", display:"Medicine1", link:"https://drive.google.com/file/d/1s9772ypXMudsLSdHn1xhtGcZCFFghYB0/view?usp=drive_link" },
      { id:"medicine-harrison", display:"Medicine -harrison's 21st edition", link:"https://drive.google.com/file/d/1BH30sXSQPr_jy4rgIKAV9j5i5xVyCJkP/view?usp=drive_link" }, { id:"surgery1", display:"Surgery1", link:"https://drive.google.com/file/d/1BbNuZcoC0MmDEPL4PBQEl7z79lsR_mhW/view?usp=drivesdk" }, { id:"surgery2", display:"Surgery2", link:"https://drive.google.com/file/d/1BhSQsc_E47jEiZhrJ8GNEfUCtmjXa7mZ/view?usp=drivesdk" },
      { id:"obg", display:"Obs", link:"https://drive.google.com/file/d/1sGDp_vEo6VTip9rCyw61_izsupMznKMo/view?usp=drive_link" },
      { id:"gynae", display:"Gynae", link:"https://drive.google.com/file/d/1sAAwpNCqfbjB-d5GqImj50qZzUDopvtR/view?usp=drive_link" },{ id:"ent", display:"ENT", link:"https://drive.google.com/file/d/1rvgHxpzvE7v4Ed13UXBTaxn3GXljfccE/view?usp=drivesdk/view?usp=drive_link" },
      { id:"oph", display:"Ophthalmology", link:"https://drive.google.com/file/d/1vd7wg3HlQanVl8Nk-W90wJOyYRzunu0g/view?usp=drive_link" },
    ]
  },
  practical: {
    1: [
      { id:"anat_prac", display:"Anatomy Practical", link:"https://drive.google.com/drive/folders/10Ft29EU_bS_gUoan5jdEiDfjohOcFNP2?usp=drive_link" },
      { id:"biochem_prac", display:"Biochemistry Practical", link:"https://drive.google.com/drive/folders/10O4j5xfVU1wNbAdljILU4CUzqzWW6tQz?usp=drive_link" },
      { id:"physio_prac", display:"Physiology Practical", link:"https://drive.google.com/drive/folders/10JWKJl7gwTZDxFPGUE7Fcpdj-JCf00pI?usp=drive_link" }
    ],
    2: [
      { id:"pharma_prac", display:"Pharmacology Practical", link:driveDemoLink },
      { id:"micro_prac", display:"Microbiology Practical", link:"https://drive.google.com/drive/folders/10fNwd3G_blev6icSZeKKvC7enYwdwPXz?usp=drive_link" },
      { id:"patho_prac", display:"Pathology Practical", link:"https://drive.google.com/drive/folders/10hJIDAfzKqhP4Hf7LM8QHBtgVbJCJt-E?usp=drive_link" }
    ],
    3: [
      { id:"psm_prac", display:"PSM Practical", link:"https://drive.google.com/drive/folders/1DrqEirK-uOLcWtV3Kna5YdAELSgcWLuC?usp=drive_link" },
      { id:"fmt_prac", display:"FMT Practical", link:"https://drive.google.com/drive/folders/1Dlm2Tlywv6CcmGTx6mrjlDQJOtJFKjWh?usp=drive_link" }
    ],
    4: [
      { id:"peds_prac", display:"Pediatrics Practical", link:"https://drive.google.com/drive/folders/13LKnFL_EncIjyOIjYhnr2q-h65JV33Up?usp=drive_link" },
      { id:"medicine_prac", display:"Medicine Practical", link:"https://drive.google.com/drive/folders/13HSI1DL7sQdXCor7D5M0cOW-eWeUNgjB?usp=drive_link" },
      { id:"surgery_prac", display:"Surgery Practical", link:"https://drive.google.com/drive/folders/13I_AjVxJ9c2P9PbSdPbxV1oYNWxsdL_0?usp=drive_link" },
      { id:"obg_prac", display:"Obs & Gynae Practical", link:"https://drive.google.com/drive/folders/13Feu58W-8KuLJJRyPYI7K7WzsH1dNcPv?usp=drive_link" },
      { id:"ent_prac", display:"ENT Practical", link:"https://drive.google.com/drive/folders/1Dkk8_8yonncVdLsLgYWukIaUDlEdrD4U?usp=drive_link" },
      { id:"oph_prac", display:"Ophthalmology Practical", link:"https://drive.google.com/drive/folders/1Dl4r6K9Z7voIWXTzkJpHWomKRighy0vy?usp=drive_link" }
    ]
  },
  books: {
    1: [
      { id:"anat_book", display:"Gray's Anatomy", link:"https://drive.google.com/file/d/1LYgXww1IEzf77uru1z7GJ5bX4wNu-xKC/view?usp=drive_link" },
      { id:"biochem_book", display:"Harper's Biochemistry", link:"https://drive.google.com/file/d/1VlH5lNZjKLJSFadunkIOTulC3_EG8rOW/view?usp=drive_link" },
      { id:"physio_book", display:"Guyton & Hall Physiology", link:"https://drive.google.com/file/d/17cDKC2198ihrikvmXMYlzs40mC26bh2f/view?usp=drive_link" }
    ],
    2: [
      { id:"pharma_book", display:"Katzung Pharmacology", link:"https://drive.google.com/file/d/1DAMdmo7CSlMEubdd7ii0BKRzEAHwIMQC/view?usp=drive_link" },
      { id:"micro_book", display:"Ananthanarayan Microbiology", link:driveDemoLink },
      { id:"patho_book", display:"Robbins Pathology", link:"https://drive.google.com/file/d/1Q3zpDAy124w-Wm6V-zdkWQ0hYYnpVHGG/view?usp=drive_link" }
    ],
    3: [
      { id:"psm_book", display:"Park's PSM", link:"https://drive.google.com/file/d/1CcaVf_8Vwzej8QjHY0-8GaXzIlO48A96/view?usp=drive_link" },
      { id:"fmt_book", display:"Reddy's FMT", link:"https://drive.google.com/file/d/1wnqsdt0st5wy60zAg7DKZFeAl_vMgu4T/view?usp=drive_link" }
    ],
    4: [
      { id:"peds_book", display:"Ghai Essential Pediatrics", link:"https://drive.google.com/file/d/1h-T62BaUuZdpA5-Cy2VM0_Ug0fICyPug/view?usp=drive_link" },
      { id:"medicine_book", display:"Harrison's Medicine", link:"https://drive.google.com/file/d/1BH30sXSQPr_jy4rgIKAV9j5i5xVyCJkP/view?usp=drive_link" },
      { id:"surgery_book", display:"Bailey & Love Surgery", link:"https://drive.google.com/file/d/1I6gYk2LUpLVqTR_eXUHr6pJQjzRZ2DZZ/view?usp=drive_link" },
      { id:"obg_book", display:"DC Datta", link:"https://drive.google.com/file/d/19eQWvG3147apXENYmFqy45MhA6IPAmMm/view?usp=drive_link" },
      { id:"ent_book", display:"Dhingra ENT", link:"https://drive.google.com/file/d/1l1Lj2npAWiAuEgLHzLzWOdJnXCRpuco2/view?usp=drive_link" },
      { id:"oph_book", display:"A K Khurana ", link:"https://drive.google.com/file/d/1sBpMLdXWWN4ONvrDB9FidHX9B16-4vOH/view?usp=drive_link" }
    ]
  },
  pyq: {
    1: [
      { id:"anat_pyq", display:"Anatomy", papers:{
        "Paper 1": {
          2022: { summer:"Anat1sun22.pdf", winter:"Anat1win22.pdf?raw=true" },
          2023: { summer:"LINK_HERE", winter:"Anat1win23.pdf.pdf" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        },
        "Paper 2": {
          2022: { summer:"Anat2sum22.pdf", winter:"LINK_HERE" },
          2023: { summer:"Anat2sum23.pdf", winter:"Anat2win23.pdf" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        }
      }},
      { id:"biochem_pyq", display:"Biochemistry", papers:{
        "Paper 1": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        },
        "Paper 2": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        }
      }},
      { id:"physio_pyq", display:"Physiology", papers:{
        "Paper 1": {
          2022: { summer:"Physio1sum22.pdf", winter:"Physio1win22.pdf" },
          2023: { summer:"Physio1sum23.pdf", winter:"Physio1win23.pdf" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        },
        "Paper 2": {
          2022: { summer:"LINK_HERE", winter:"Physio2win22.pdf" },
          2023: { summer:"LINK_HERE", winter:"Physio2win23.pdf" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        }
      }}
    ],
    2: [
      { id:"pharma_pyq", display:"Pharmacology", papers:{
        "Paper 1": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        },
        "Paper 2": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        }
      }},
      { id:"micro_pyq", display:"Microbiology", papers:{
        "Paper 1": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        },
        "Paper 2": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        }
      }},
      { id:"patho_pyq", display:"Pathology", papers:{
        "Paper 1": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        },
        "Paper 2": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        }
      }}
    ],
    3: [
      { id:"psm_pyq", display:"PSM", papers:{
        "Paper 1": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"MUHS_PSM_PYQ's.pdf" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        },
        "Paper 2": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        }
      }},
      { id:"fmt_pyq", display:"FMT", papers:{
        "Paper 1": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"MUHS_FMT_PYQ's.pdf" },
          2024: { summer:"LINK_HERE", winter:"https://drive.google.com/file/d/1ws2QOWEANKWJupZaCBFFs71Af_Xo5L9Q/view?usp=share_link" }
        },
        "Paper 2": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        }
      }}
    ],
    4: [
      { id:"peds_pyq", display:"Pediatrics", papers:{
        "Paper 1": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"paedssum23.pdf", winter:"paedswin23.jpg" },
          2025: { summer:"image.jpeg", winter:"peds_win2025.jpg" }
        },
        "Paper 2": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        }
      }},
      { id:"medicine_pyq", display:"Medicine", papers:{
        "Paper 1": {
          2022: { summer:"LINK_HERE", winter:"med1winter2022.jpg" },
          2023: { summer:"summer med1 2023.jpg", winter:"Winter2023.pdf" },
          2025: { summer:"summer2024med1.jpg", winter:"med1win2025.jpg" }
        },
        "Paper 2": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2025: { summer:"Med2sum24.pdf", winter:"med2win2025.jpg" }
        }
      }},
      { id:"surgery_pyq", display:"Surgery", papers:{
        "Paper 1": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"sur1 summer 23.jpg", winter:"win 2023sur1.jpg" },
          2025: { summer:"LINK_HERE", winter:"sur1win2025.jpg" }
        },
        "Paper 2": {
          2022: { summer:"LINK_HERE", winter:"Sur2win22.pdf" },
          2023: { summer:"sur2sum23.pdf", winter:"sur2win23.jpg" },
          2025: { summer:"sur2sum24.pdf", winter:"sur2win25.jpg" }
        }
      }},
      { id:"obg_pyq", display:"Obs & Gynae", papers:{
        "Paper 1": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"obgy1sum23.pdf", winter:"obgy1win23.jpg" },
          2025: { summer:"Obs1sumeer2024.jpg", winter:"obgy1win2025.jpeg" }
        },
        "Paper 2": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"obgy2sum23.pdf", winter:"obgy2win23.jpg" },
          2025: { summer:"LINK_HERE", winter:"obgy2win2025.jpeg" }
        }
      }},
      { id:"ent_pyq", display:"ENT", papers:{
        "Paper 1": {
          2022: { summer:"LINK_HERE", winter:"entwin22.pdf" },
          2023: { summer:"entsum23.pdf", winter:"entwin23.pdf" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        },
        "Paper 2": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        }
      }},
      { id:"oph_pyq", display:"Ophthalmology", papers:{
        "Paper 1": {
          2022: { summer:"LINK_HERE", winter:"opthalmwin22.pdf" },
          2023: { summer:"opthalmsum23.pdf", winter:"opthalmwin23.pdf" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        },
        "Paper 2": {
          2022: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2023: { summer:"LINK_HERE", winter:"LINK_HERE" },
          2024: { summer:"LINK_HERE", winter:"LINK_HERE" }
        }
      }}
    ]
  }
};

const state = { tab: "notes", year: "1", search: "" };

/* ======= RENDER ======= */
const grid = document.getElementById("cardsGrid");
const countEl = document.getElementById("count");

function getSubjects(){
  const list = DATA[state.tab][state.year] || [];
  const term = state.search.trim().toLowerCase();
  return list.filter(s => s.display.toLowerCase().includes(term));
}

// Function to check if user has premium access
async function checkPremiumStatus(subjectId) {
  const user = auth.currentUser;
  if (!user) return false;
  
  try {
    const userRef = db.collection('users').doc(user.uid);
    const userDoc = await userRef.get();
    
    if (userDoc.exists) {
      const userData = userDoc.data();
      return userData[`premium_${subjectId}`] || false;
    }
    return false;
  } catch (error) {
    console.error("Error checking premium status:", error);
    return false;
  }
}

// Update the render function to check premium status
async function render(){
  const list = getSubjects();
  grid.innerHTML = "";

  const card = document.createElement("div");
  card.className = "card";
  const yearNames = {1:"1st Year",2:"2nd Year",3:"3rd Year",4:"4th Year"};
  const tabNames = {
    "notes": "Handwritten Notes",
    "practical": "Practical Notes", 
    "books": "MBBS Books",
    "pyq": "Previous Year Questions"
  };
  card.innerHTML = `<h3><i class="fa-solid fa-graduation-cap"></i> ${yearNames[state.year]} ‚Äì ${tabNames[state.tab]}</h3>
                    <div class="sub-list"></div>`;
  const subList = card.querySelector(".sub-list");

  for (const sub of list) {
    const row = document.createElement("div");
    row.className = "sub";
    row.dataset.id = sub.id;
    
    // Check if user already has premium access
    const hasPremium = sub.premium ? await checkPremiumStatus(sub.id) : true;
    
    row.innerHTML = `
      <div class="left">
        <span class="tag">Y${state.year}</span>
        ${(state.tab==="notes" || state.tab==="practical" || state.tab==="books") && sub.link && hasPremium ? 
          `<a href="${sub.link}" target="_blank" title="Open Drive link" style="margin-right:6px;">
            <i class="fa-brands fa-google-drive" style="color:#4285F4"></i>
          </a>` : ""}
        <strong>${sub.display}</strong>
        ${hasPremium && sub.premium ? '<span style="color: green; font-size: 10px; margin-left: 5px;">‚úì UNLOCKED</span>' : ''}
      </div>
      <div class="acts">
${sub.premium && !hasPremium ? 
  `<button class="icon-btn pay" data-act="pay" data-id="${sub.id}" data-price="${sub.price}">
      Unlock ‚Çπ${sub.price}
   </button>` 
:
  `<button class="icon-btn view" title="Preview" data-act="view">
      <i class="fa-regular fa-eye"></i>
   </button>`
}
</div>
    `;
    subList.appendChild(row);
  }

  if(list.length === 0){
    subList.innerHTML = `<p class="muted">No subjects found ‚ùó</p>`;
  }

  grid.appendChild(card);
  countEl.textContent = list.length;
}

/* ======= INTERACTION ======= */
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    state.tab = btn.dataset.tab;
    render(); // This will now call the async render
  });
});

document.querySelectorAll(".pill").forEach(p=>{
  p.addEventListener("click", ()=>{
    document.querySelectorAll(".pill").forEach(x=>x.classList.remove("active"));
    p.classList.add("active");
    state.year = p.dataset.year;
    render(); // This will now call the async render
  });
});

const searchBox = document.getElementById("searchBox");
searchBox.addEventListener("input", (e)=>{ 
  state.search = e.target.value; 
  render(); // This will now call the async render
});

document.getElementById("clearSearch").addEventListener("click", ()=>{ 
  searchBox.value=""; 
  state.search=""; 
  render(); // This will now call the async render
});

/* ======= CLICK HANDLER ======= */
grid.addEventListener("click", (e) => {
  const target = e.target.closest("[data-act]");
  if (!target) return;

  const row = e.target.closest(".sub");
  if (!row) return;

  const subjectList = DATA[state.tab][state.year] || [];
  const subject = subjectList.find(s => s.id === row.dataset.id);

  if (!subject) return;

  /* -------- PAYMENT HANDLER -------- */
  if (target.dataset.act === "pay") {
    const id = target.dataset.id;
    const price = target.dataset.price;

    const user = auth.currentUser;
    if (!user) {
      alert("Please login first!");
      return;
    }

    payWithRazorpay(id, price);
    return;
  }

  /* -------- VIEW HANDLER -------- */
  if (target.dataset.act === "view" && subject) {
    if ((state.tab === "notes" || state.tab === "practical" || state.tab === "books") && subject.link) {
      openModal(subject.display, `
        <p>
          <a href="${subject.link}" target="_blank" style="font-weight:bold;color:#2a5c8f;">
            View/Download Resource
          </a>
        </p>
      `);
      return;
    }
    
    // PYQ modal rendering
    if(state.tab === "pyq" && subject.papers){
      let html = `<div style="margin-top:6px;">`;
      for(const paperName of Object.keys(subject.papers)){
        html += `<div class="pyq-paper"><strong>${paperName}</strong>`;
        const yearsObj = subject.papers[paperName];
        for(const yr of Object.keys(yearsObj)){
          const sets = yearsObj[yr];
          html += `<div class="pyq-year"><span style="min-width:60px;font-weight:700">${yr}</span>`;
          // Summer
          if(sets && sets.summer && sets.summer !== "LINK_HERE"){
            html += `<a class="btn-link btn-summer" href="${sets.summer}" target="_blank" rel="noopener">Summer</a>`;
          } else {
            html += `<span class="btn-disabled">Summer ‚Äî</span>`;
          }
          // Winter
          if(sets && sets.winter && sets.winter !== "LINK_HERE"){
            html += `<a class="btn-link btn-winter" href="${sets.winter}" target="_blank" rel="noopener">Winter</a>`;
          } else {
            html += `<span class="btn-disabled">Winter ‚Äî</span>`;
          }
          html += `</div>`;
        }
        html += `</div>`; // .pyq-paper
      }
      html += `</div>`;

      openModal(subject.display + " - PYQs", html);
      return;
    }

    // fallback
    openModal("Preview", `<p class="muted">No data available for <b>${row.dataset.id}</b>.</p>`);
  }
});

/* ======= MODAL ======= */
const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modalTitle");
const modalBody  = document.getElementById("modalBody");
document.getElementById("modalClose").addEventListener("click", ()=> modal.classList.remove("show"));
modal.addEventListener("click", (e)=> {
  if(e.target === modal) modal.classList.remove("show"); // click outside dialog closes
});
function openModal(title, html){
  modalTitle.textContent = title;
  modalBody.innerHTML = html;
  modal.classList.add('show');
}

/* ======= INIT ======= */
(async function init(){
  await render(); // Make this async too
  document.getElementById("yr").textContent = new Date().getFullYear();
})();

// Initialize DOM event listeners after page load
document.addEventListener('DOMContentLoaded', function() {
  const loginModal = document.getElementById('loginModal');
  const signupModal = document.getElementById('signupModal');
  const showSignupLink = document.getElementById('showSignup');
  const showLoginLink = document.getElementById('showLogin');
  const closeSignupButton = document.getElementById('closeSignup');

  // Function to show the Signup modal and hide the Login modal
  if (showSignupLink) {
      showSignupLink.addEventListener('click', function(e) {
          e.preventDefault();
          if (loginModal) loginModal.style.display = 'none';
          if (signupModal) signupModal.classList.add('show');
      });
  }

  // Function to show the Login modal and hide the Signup modal
  if (showLoginLink) {
      showLoginLink.addEventListener('click', function(e) {
          e.preventDefault();
          if (signupModal) signupModal.classList.remove('show');
          if (loginModal) loginModal.style.display = 'flex';
      });
  }

  // Function to close the Signup modal (goes back to login since it's the main gate)
  if (closeSignupButton) {
      closeSignupButton.addEventListener('click', function() {
          if (signupModal) signupModal.classList.remove('show');
          if (loginModal) loginModal.style.display = 'flex'; // Optional: show login again
      });
  }
});

// Payment function - UPDATED VERSION
function payWithRazorpay(id, price) {
  const user = auth.currentUser;
  if (!user) {
    alert("Please login first!");
    return;
  }

  var options = {
    key: "rzp_live_RhXM2yASrfI7Mk",
    amount: price * 100,
    currency: "INR",
    name: "MedStudyEasy",
    description: "Unlock " + id,
    handler: async function (response) {
      alert("Payment Success! Updating unlock‚Ä¶");

      try {
        const userRef = db.collection('users').doc(user.uid);
        const userDoc = await userRef.get();
        
        if (!userDoc.exists) {
          // Create the user document if it doesn't exist
          await userRef.set({
            email: user.email,
            premium_surgery1: false,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
          });
        }

        // Now update the premium status
        await userRef.update({
          ["premium_" + id]: true,
          lastPayment: firebase.firestore.FieldValue.serverTimestamp()
        });

        alert("UNLOCKED ‚úî");
        location.reload();

      } catch (err) {
        console.error("Payment processing error:", err);
        alert("Payment processing error ‚ùå: " + err.message);
      }
    },
    prefill: {
      name: user.displayName || "Medical Student",
      email: user.email
    },
    theme: {
      color: "#8B0000"
    }
  };

  var rzp = new Razorpay(options);
  rzp.open();
}
</script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</body>
</html>
